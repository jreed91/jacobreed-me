<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Create a simple pager utilizing AngularJS dir-paginate and ASP.NET 5 API</title>
    <meta name="description" content="A daily stream of content from the mind of Jacob Reed.
">


    <link href='http://fonts.googleapis.com/css?family=Open+Sans:600,400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Vollkorn:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Ovo' rel='stylesheet' type='text/css'>


    <!-- Twitter Tags -->
    <meta name="twitter:site" content="@jreed91">
    <meta name="twitter:creator" content="@jreed91">
    <meta name="twitter:description" content="A daily stream of content from the mind of Jacob Reed.
">
    <meta name="twitter:title" content="Create a simple pager utilizing AngularJS dir-paginate and ASP.NET 5 API">
    <meta name="twitter:url" content="http://jacobreed.me//2016/01/12/Create-a-simple-pager-utilizing-AngularJS-dir-paginate-and-ASP.NET-5-API.html">
    
    
    <meta name="twitter:card" content="summary">
    


    <!-- Facebook Tags -->
    <meta property="og:title" content="Create a simple pager utilizing AngularJS dir-paginate and ASP.NET 5 API" />
    <meta property="og:site_name" content="Stream-Of-Consciousness"/>
    <meta property="og:url" content="/2016/01/12/Create-a-simple-pager-utilizing-AngularJS-dir-paginate-and-ASP.NET-5-API.html"/>
    <meta property="og:desciption" content="A daily stream of content from the mind of Jacob Reed.
"/>
    
    
    <link rel="stylesheet" href="/css/main.css">

    <link rel="canonical" href="jacobreed.me/2016/01/12/Create-a-simple-pager-utilizing-AngularJS-dir-paginate-and-ASP.NET-5-API.html">
    
</head>


  <body>
<div class="wrapper">
    <div class="container">
  <header class="site-header">
    <!-- <div class="logo">
    
    <a href="jacobreed.me" class="site-title sitelogo"><img src="/img/logo.png"></img></a>
    </div>

    <div class="title">
    <a href="jacobreed.me">
      <h1>Stream-Of-Consciousness</h1>
    </a>
      <p class="subheading"></p>
    </div> -->
    <div class="logo">
      <a href="jacobreed.me" class="brand"><img src="/img/logo.png"></img>
      <div class="title">
          <h4>Stream-Of-Consciousness</h4>
      </div>
      </a>
    </div>
    <div class="site-nav">
       <a class="sub-nav" href="/elsewhere.html">Elsewhere</a>
       <a class="sub-nav2" href="/archive.html">Archives</a>
    </div> 

  </header>

</div>

  
    <div class="content">
        
<div class="container">
	<article class="post">
	<div class="post-header">
    <h2  class="post-title">Create a simple pager utilizing AngularJS dir-paginate and ASP.NET 5 API</h2>
    <span class="post-meta">Jan 12, 2016</span>
</div>
	  <div class="post-content">
	    <p>Today I’m going to walk you through how to build a simple server-side pager utilizing AngularJS, C#, and ASP.NET 5 on OS X. </p>

<h2 id="getting-set-up">Getting Set Up</h2>

<p>I built this application utilizing the new cross-platform ASP.NET 5 on OS X. To get started we will need to set up your development environment on OS X.</p>

<ol>
  <li>
    <p>Follow the set up instructions for OS X <a href="https://docs.asp.net/en/latest/getting-started/installing-on-mac.html">here</a>.</p>
  </li>
  <li>
    <p>Once you have everything installed we’re going to start scaffolding our project. Navigate to the folder you want the files to live and <a href="https://docs.asp.net/en/latest/client-side/yeoman.html">follow these instructions</a> on how to set up yeoman. </p>
  </li>
</ol>

<h2 id="download-our-dependencies">Download Our Dependencies</h2>

<p>You should now have a simple ASP.NET website structure set up. Now we need to get Angular.JS set up and other dependencies installed.</p>

<p>Make sure you have bower installed:</p>

<pre><code>npm install -g bower
</code></pre>

<p>In my template I was missing a .bowerrc file, add this to the root of your directory and type:</p>

<pre><code>{
  	"directory": "wwwroot/lib"
}
</code></pre>

<p>This will help make sure that all your bower dependencies are loading into the lib folder. </p>

<p>Now we can start adding our dependencies to the bower file.</p>

<p>Add this to our bower.json:</p>

<pre><code>{
    "name": "ASP.NET",
    "private": true,
    "dependencies": {
	    "angular": "1.4.8",
	    "bootstrap": "3.3.5",
	    "jquery": "2.1.4",
	    "jquery-validation": "1.14.0",
	    "jquery-validation-unobtrusive": "3.2.4",
	    "angularUtils-pagination": "*"
	}
}
</code></pre>

<p>After saving, open up terminal in your directory and type:</p>

<pre><code>bower update
</code></pre>

<p>You now see all of our dependencies loaded into the lib folder.</p>

<h2 id="create-our-api">Create Our API</h2>

<p>We can now start building our API. First start let’s build our Model. In the Models folder create a new class named Item.cs. Add the attributes you want to track, for simplicity here is mine:</p>

<pre><code>namespace angularjs_aspnet_paginate.Models
{
    public class Item
    {
        public int Id { get; set; }

        public string Name { get; set; }
    }
}
</code></pre>

<p>We also need to create a model for the data we will return. Call this class PagedCollection.cs and add the following:</p>

<p>using System.Linq;
using System.Collections.Generic;</p>

<pre><code>namespace angularjs_aspnet_paginate.Models
{
    public class PagedCollection&lt;T&gt;
    {
        public int Page { get; set; }

        public int Count
        {
            get
            {
                return (null != this.Items) ? this.Items.Count() : 0;
            }
        }

        public int TotalPages { get; set; }
        public int TotalCount { get; set; }

        public IEnumerable&lt;T&gt; Items { get; set; }
    }
}
</code></pre>

<p>This is the data we will return from our API to our client. It includes the pagee number, a count of number of items, a count of total pages, total count of items overall, and the items. </p>

<p>Now that we have our models we can build our API. Create a new Controller: ItemsController.cs. Here is the relevant code for returning Items:</p>

<pre><code> // GET: api/paginate
[HttpGet]
public PagedCollection&lt;Item&gt; Get(int? page, int? pageSize)
{
    var currPage = page.GetValueOrDefault(0);
    currPage = currPage - 1;
    var currPageSize = pageSize.GetValueOrDefault(10);

    var paged = _items.Skip(currPage * currPageSize)
                        .Take(currPageSize)
                        .ToArray();

    var totalCount = _items.Count();

    return new PagedCollection&lt;Item&gt;()
    {
        Page = currPage,
        TotalCount = totalCount,
        TotalPages = (int)Math.Ceiling((decimal)totalCount / currPageSize),
        Items = paged
    };
}
</code></pre>

<p>This api takes a GET request with the current page and the page size (i.e. how many items should be displayed). We then use a linq query to get the data from _items based on the current page number and page size:</p>

<pre><code>static ItemsController() {
	_items = Enumerable.Range(1, 100)
    	.Select(i =&gt; new Item()
        {
            Id = i,
            Name = "Item " + i.ToString()
        }).ToArray();
}
</code></pre>

<p>We get our total count of items and return the PagedCollection model. After building out this structure open up terminal and type:</p>

<pre><code>dnx web
</code></pre>

<p>If you go to http://localhost:5000/api/items?page=1&amp;pageSize=1, you should now be able to see the data being returned.</p>

<h2 id="start-building-the-front-end">Start Building the Front-End</h2>

<p>Now that we have our API built we can start building our front-end code. </p>

<ol>
  <li>Create a new folder names Views</li>
  <li>Add two files _ViewStart.cshtml and _ViewImports.cshtml</li>
</ol>

<p>See the following code for these files:</p>

<p>_ViewStart.cshtml:
	@{
	    Layout = “_Layout”;
	}</p>

<p>_ViewImports.cshtml:
	@using angularjs_aspnet_paginate
	@using angularjs_aspnet_paginate.Models</p>

<ol>
  <li>Add another folder with Views called Shared</li>
  <li>Add a file named _Layout.cshtml</li>
</ol>

<p>This is the file that will load all of your client side html after _ViewStart.cshtml is called. I grabbed most of the code from Microsoft’s example <a href="https://github.com/aspnet/Docs/blob/master/aspnet/client-side/angular/sample/AngularSample/src/AngularSample/Views/Shared/_Layout.cshtml">here</a>.</p>

<ol>
  <li>Add another folder names Home inside Views</li>
  <li>Add a file named Index.cshtml. This is the file that will load once RenderBody() is called.</li>
  <li>
    <p>In order for all of this to work we need to add a HomeController to our ASP.NET code. Add HomeController.cs  under the Controllers folder:</p>

    <p>using Microsoft.AspNet.Mvc;</p>

    <p>namespace angularjs_aspnet_paginate.Controllers
 {
     public class HomeController : Controller {</p>

    <pre><code>      public IActionResult Index()
        {
             return View();
        }
 }  }
</code></pre>
  </li>
</ol>

<p>This is ust saying when I hit the home controller load my initial Index view. We also need to add the following code to our Startup.cs Configure method:</p>

<pre><code>app.UseMvc(routes =&gt;
    {
        routes.MapRoute(
            name: "default",
            template: "{controller=Home}/{action=Index}/{id?}");
    });
</code></pre>

<p>You can now test the application to see the intial view load.</p>

<h2 id="build-our-angularjs-code">Build our AngularJS code.</h2>

<p>Now open up Views/Home/Index.cshtml and build our boilerplate code.</p>

<pre><code>@{
    ViewData["Title"] = "Home Page";
}

&lt;div ng-app="paginationApp"&gt;
    &lt;div ng-controller="ItemsCtrl"&gt;  
        &lt;li dir-paginate="item in items | itemsPerPage: itemsPerPage" total-items="totalItems" current-page="pagination.current"&gt;
            
        &lt;/li&gt;
        &lt;dir-pagination-controls on-page-change="pageChanged(newPageNumber)" template-url="lib/angularUtils-pagination/dirPagination.tpl.html"&gt;&lt;/dir-pagination-controls&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p>There’s a lot in this so let me go explain:
1. The ViewData is a ASP.NET snippet that just sets the TItle of the page
2. We then bootstrap our AngularJS app with an ng-app. I will show the code for this a bit.
3. We then define the AngularJS controller for this page. This will control all the user actions
4. Then utilizing the <a href="https://github.com/michaelbromley/angularUtils/tree/master/src/directives/pagination#installation">dir-paginate module</a>, we create something similar to an ng-repeat. For each item print our the item.Name.
4. We then add our dir-pagination controls.</p>

<p>Now we can add the app.js that wires all this up. Add an app folder insides the wwwroot folder. I just referenced what was created at the dir-paginate modules github page.</p>

<ol>
  <li>
    <p>Bootstrap our AngularJS app:
 var paginationApp = angular.module(“paginationApp”, [“angularUtils.directives.dirPagination”]);</p>
  </li>
  <li>
    <p>Define our controller, injecting in $scope and $http:
 paginationApp.controller(‘ItemsCtrl’, function($scope, $http) {}</p>
  </li>
  <li>
    <p>Set up some initial variables:
 $scope.items = [];
 $scope.totalItems = 0;
 $scope.itemsPerPage = 10;// this should match however many results your API puts on one page
 getResultsPage(1);</p>
  </li>
  <li>
    <p>Define our functions for handling the user interactions:
 	$scope.pagination = {
    current: 1
};</p>

    <p>$scope.pageChanged = function(newPage) {
    getResultsPage(newPage);
};</p>

    <p>function getResultsPage(pageNumber) {
    // this is just an example, in reality this stuff should be in a service
    $http.get(‘api/items?page=’ + pageNumber + ‘&amp;pageSize=’ + $scope.itemsPerPage)
        .then(function(result) {
            console.log(result);
            $scope.items = result.data.Items;
            $scope.totalItems = result.data.TotalCount
        });
}</p>
  </li>
</ol>

<p>You should now have a working AngularJS server-side pagination with an ASP.NET API. </p>

<h3 id="references">References:</h3>
<ul>
  <li><a href="mizrael/AngularJs-Pagination">https://github.com/mizrael/AngularJs-Pagination/tree/master/DemoAngularPagination</a></li>
  <li><a href="https://docs.asp.net/en/latest/">ASP.NET Docs</a></li>
  <li><a href="https://github.com/mizrael/AngularJs-Pagination">Dir-Paginate Module</a></li>
</ul>

	  </div>
  	</article>
</div>

<div class="container">
  
<article class="post">
<hr>
	<div class="post-footer">
	  	<img data-scroll-reveal="reset enter left and move 50px over 1.33s"  class="me" src="/img/me.jpg" />
	  	<div data-scroll-reveal="reset enter left and move 50px over 1.33s"  class="author-info">
	  		<h6>Written By</h6>
	  		<span class="meta">Jacob Reed</span>
	  		<h6>Posted On</h6>
	  		<span class="meta">Jan 12, 2016</span>
	  	</div>
	  	<div class="share">
	  		<h6>Share</h6>
	  		<a data-scroll-reveal="enter right and move 50px over 1s" href='http://twitter.com/home?status=Create a simple pager utilizing AngularJS dir-paginate and ASP.NET 5 API via @jreed91 jacobreed.me/2016/01/12/Create-a-simple-pager-utilizing-AngularJS-dir-paginate-and-ASP.NET-5-API.html' class='symbol' title='twitterbird'></a>
	  		<a data-scroll-reveal="enter right and move 50px over 1s, after 0.3s" href='http://www.facebook.com/sharer/sharer.php?u=jacobreed.me/2016/01/12/Create-a-simple-pager-utilizing-AngularJS-dir-paginate-and-ASP.NET-5-API.html&t=Create a simple pager utilizing AngularJS dir-paginate and ASP.NET 5 API' class='symbol' title='facebook'></a>
	  		<a data-scroll-reveal="enter right and move 50px over 1s, after 0.6s" href='http://www.linkedin.com/shareArticle?mini=true&url=jacobreed.me/2016/01/12/Create-a-simple-pager-utilizing-AngularJS-dir-paginate-and-ASP.NET-5-API.html&title=Create a simple pager utilizing AngularJS dir-paginate and ASP.NET 5 API&summary=&source=jacobreed.me' class='symbol' title='linkedin'></a>
	  	</div>
	</div>
</article>
</div>

    </div>

    <div class="push"></div>
</div>
        <footer class="site-footer">
      <div class="container">
        <div class="rss-subscribe" data-scroll-reveal="reset enter top and move 20px over 1.33s">
          <a class="symbol" title="rss" href="/feed.xml">
            <p class="subscribe">subscribe</p>
          </a>
          <a class="symbol" title="twitter" href="http://www.twitter.com/jreed91">
            <p class="subscribe">Tweet</p>
          </a>
          <a class="symbol" title="instagram" href="http://www.instagram.com/jreed91">
            <p class="subscribe">Follow</p>
          </a>
        </div>
        <div class="footer-links">
          <a href="/archive.html">Archives</a> · <a href="jacobreed.me">Jacob Reed</a>
        </div>
      </div>
    </footer>
<script src="/js/scrollReveal.min.js"></script>
<script src="/js/intense.min.js"></script>
<script src="/js/jekyll-search.js"></script>
<script type="text/javascript">
    SimpleJekyllSearch.init({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('results-container'),
  searchResultTemplate: '<li><span>{date}</span> - <a href="{url}" title="{desc}">{title}</a></li>',
  noResultsText: '<h1>No Results Found</h1>',
  dataSource: '/search.json'
})
</script>
<script>
            window.scrollReveal = new scrollReveal();
          </script>
          <script>
          window.onload = function() {
              // Intensify all images on the page.
              var elements = document.querySelectorAll( 'img' );
              Intense( elements );
          }
          </script>
       <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58156467-1', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>

  </body>

</html>
